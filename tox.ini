# For use with pyct (https://github.com/pyviz/pyct), but just standard
# tox config (works with tox alone).

[tox]
#          python version             test group                    extra envs  extra commands
envlist = {py38,py39,py310,py311}-{unit,examples,all}-{default}-{dev,pkg}

[_unit]
description = Run unit tests with coverage
deps = .[tests]
commands = pytest -v hvplot --cov=./hvplot --cov-append
           pytest -v hvplot --geo --cov=./hvplot --cov-append

[_examples]
description = Test that default examples run
deps = .[examples_tests, tests]
commands = pytest -n auto --dist loadscope --nbval-lax -p no:python

[_all]
description = Run all tests
deps = .[examples_tests, tests]
commands = {[_unit]commands}
           {[_examples]commands}

[_pkg]
commands = bokeh sampledata

[testenv]
# geoviews dependency cartopy and test dependency iris cannot be
# installed by pip alone, so provide access to site-packages and do
# not install deps with pip.
sitepackages = True
install_command = pip install --no-deps {opts} {packages}

changedir = {envtmpdir}

commands = examples-pkg: {[_pkg]commands}
           unit: {[_unit]commands}
           examples: {[_examples]commands}
           all: {[_all]commands}

deps = unit: {[_unit]deps}
       examples: {[_examples]deps}
       all: {[_all]deps}

[flake8]
include = *.py
# run_tests.py is generated by conda build, which appears to have a
# bug resulting in code being duplicated a couple of times.
exclude = .git,__pycache__,.tox,.eggs,*.egg,doc,dist,build,_build,.ipynb_checkpoints,run_test.py
ignore = E,
         W
